(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}const e=function(){function e(){}return e.extend=function(){for(var e=1;e<arguments.length;e++)for(var n in arguments[e])Object.prototype.hasOwnProperty.call(arguments[e],n)&&("object"===t(arguments[0][n])&&"object"===t(arguments[e][n])?this.extend(arguments[0][n],arguments[e][n]):arguments[0][n]=arguments[e][n]);return arguments[0]},e.htmlDecode=function(t){var e=(new DOMParser).parseFromString(t,"text/html");return e.documentElement?e.documentElement.textContent:""},e.formatLanguageCode=function(t){if("string"!=typeof t)return t;var e=t.split("-");return e[0]=e[0].toLowerCase(),e.length>1&&(e[1]=e[1].toUpperCase()),t=e.join("-")},e.isTask=function(t,e){return"H5P.CoursePresentation"===e?t.isTask:t.getMaxScore&&t.getMaxScore()>0},e.addMixins=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t.prototype){Array.isArray(e)||(e=[e]);var n=t.prototype;e.forEach((function(t){var e=t.prototype;Object.getOwnPropertyNames(e).forEach((function(t){if("constructor"!==t){if(Object.getOwnPropertyNames(n).includes(t))throw"Class ".concat(n.constructor.name," already contains ").concat(t,". Cannot add ").concat(e.constructor.name);n[t]=e[t]}}))}))}},e}();var n=function(){function t(t,n){this.params=e.extend({l10n:{nothingToSee:""}},t||{}),this.callbacks=n||{},this.message=document.createElement("div"),this.message.classList.add("h5p-ar-scavenger-content-action-message"),this.message.innerText=e.htmlDecode(this.params.l10n.nothingToSee),this.actionWrapper=document.createElement("div"),this.actionWrapper.classList.add("h5p-ar-scavenger-content-action-library-wrapper"),this.actionWrapper.classList.add("h5p-ar-scavenger-display-none"),this.content=document.createElement("div"),this.content.classList.add("h5p-ar-scavenger-content-action"),this.content.appendChild(this.actionWrapper),this.content.appendChild(this.message),this.container=document.createElement("div"),this.container.classList.add("h5p-ar-scavenger-content-action-container"),this.container.appendChild(this.content)}var n=t.prototype;return n.resizeIframeHeight=function(t){this.container.style.maxHeight="number"==typeof t?"".concat(t,"px"):""},n.getDOM=function(){return this.container},n.show=function(){this.container.classList.remove("h5p-ar-scavenger-display-none"),this.actionWrapper.setAttribute("tabindex",0),this.actionWrapper.focus()},n.hide=function(){this.actionWrapper.setAttribute("tabindex",-1),this.container.classList.add("h5p-ar-scavenger-display-none")},n.toggleView=function(t){void 0===t?this.container.classList.toggle("h5p-ar-scavenger-action-mode"):t?this.container.classList.add("h5p-ar-scavenger-action-mode"):this.container.classList.remove("h5p-ar-scavenger-action-mode")},n.attachInstance=function(t){this.content.removeChild(this.actionWrapper),this.actionWrapper=t,this.content.appendChild(this.actionWrapper)},n.showContent=function(){this.actionWrapper.classList.remove("h5p-ar-scavenger-display-none"),this.message.classList.add("h5p-ar-scavenger-display-none")},n.hideContent=function(){this.actionWrapper.classList.add("h5p-ar-scavenger-display-none"),this.message.classList.remove("h5p-ar-scavenger-display-none")},t}(),i=function(){function t(t,n){this.params=e.extend({fallbackHeight:400},t||{}),this.callbacks=n||{},this.callbacks.onResize=this.callbacks.onResize||function(){},this.callbacks.onMarkerFound=this.callbacks.onMarkerFound||function(){},this.callbacks.onMarkerLost=this.callbacks.onMarkerLost||function(){},this.maxHeight=null,this.content=document.createElement("div"),this.content.classList.add("h5p-ar-scavenger-content-camera"),this.iframe=this.buildIframe(),this.content.appendChild(this.iframe),this.container=document.createElement("div"),this.container.classList.add("h5p-ar-scavenger-content-camera-container"),this.container.appendChild(this.content)}var n=t.prototype;return n.getDOM=function(){return this.container},n.resizeIframeHeight=function(t){this.maxHeight="number"==typeof t?t:null,this.container.style.removeProperty("max-height"),this.container.style.removeProperty("max-width");var e=this.content.currentStyle||window.getComputedStyle(this.content),n=parseInt(e.marginTop)+parseInt(e.marginBottom),i=parseInt(e.marginLeft)+parseInt(e.marginRight);this.videoRatio=this.videoRatio||this.video?this.video.offsetWidth/this.video.offsetHeight:null,this.maxHeight&&(this.container.style.maxHeight="".concat(this.maxHeight,"px"));var a=Math.max(this.container.offsetWidth-i,document.body.offsetWidth);this.maxHeight&&a/this.videoRatio>this.maxHeight?(this.container.style.maxWidth="".concat(this.maxHeight*this.videoRatio,"px"),this.iframe.style.height="".concat(this.maxHeight-n,"px")):(this.container.style.maxWidth="".concat(document.body.offsetWidth-i,"px"),this.iframe.style.height="".concat((this.container.offsetWidth-i)/this.videoRatio||this.params.fallbackHeight,"px")),this.callbacks.onResize()},n.resize=function(){this.resizeIframeHeight(this.maxHeight)},n.show=function(){this.container.classList.remove("h5p-ar-scavenger-display-none")},n.hide=function(){this.container.classList.add("h5p-ar-scavenger-display-none")},n.setNarrowView=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?this.container.classList.add("h5p-ar-scavenger-narrow-screen"):this.container.classList.remove("h5p-ar-scavenger-narrow-screen")},n.toggleView=function(){this.container.classList.toggle("h5p-ar-scavenger-action-mode")},n.buildIframe=function(){var t=this,e=document.createElement("iframe");return e.classList.add("h5p-ar-scavenger-content-camera-iframe"),e.setAttribute("allow","camera *;"),e.setAttribute("tabindex",-1),e.addEventListener("load",(function(){t.iframeLoaded||(t.handleIframeLoaded(t.iframe),t.iframeLoaded=!0)})),e},n.buildHTML=function(){var t=document.createElement("html");return t.appendChild(this.buildHeader()),t.appendChild(this.buildBody()),t},n.buildHeader=function(){var t=document.createElement("head"),e=document.createElement("style");e.setAttribute("type","text/css"),e.innerHTML="#arjsDebugUIContainer {display: none;} .a-enter-vr,.a-enter-ar  {display: none;}",t.appendChild(e);var n=document.createElement("script");n.text=H5P.AFrame.toString(),t.appendChild(n);var i=document.createElement("script");i.text=H5P.AFrameAR.toString(),t.appendChild(i);var a=document.createElement("script");return a.text="H5PAFrame();",a.text+="H5PAFrameAR();",t.appendChild(a),t},n.buildBody=function(){var t=document.createElement("body");return t.style.margin="0",t.style.overflow="hidden",t.style.padding="0",t.appendChild(this.buildScene()),t},n.buildScene=function(){var t=this,e=document.createElement("a-scene");e.setAttribute("embedded",""),e.setAttribute("arjs","sourceType: webcam; sourceWidth:1920; sourceHeight:1080; debugUIEnabled: false;"),this.params.markers.forEach((function(n,i){var a=document.createElement("a-marker");a.setAttribute("type","pattern"),a.setAttribute("preset","custom"),a.setAttribute("id",i);var s=H5P.getPath(n.markerPattern.path,t.params.contentId);if(a.setAttribute("url",s),"model"===n.actionType){var r=n.model.file.path,o=r.split(".").slice(-1)[0],c=r.split("/").slice(-1)[0].split(".").slice(0,-1).join("-");if("gltf"===o||"glb"===o){var h=document.createElement("a-asset-item");h.setAttribute("id",c),h.setAttribute("src",H5P.getPath(r,t.params.contentId));var l=document.createElement("a-asset");l.appendChild(h),e.appendChild(l);var u="".concat(n.model.geometry.scale.scale/100," ").concat(n.model.geometry.scale.scale/100," ").concat(n.model.geometry.scale.scale/100),d="".concat(n.model.geometry.rotation.x," ").concat(n.model.geometry.rotation.y," ").concat(n.model.geometry.rotation.z),m="".concat(n.model.geometry.position.x," ").concat(n.model.geometry.position.y," ").concat(n.model.geometry.position.z),p=document.createElement("a-entity");p.setAttribute("gltf-model","#"+c),p.setAttribute("scale",u),p.setAttribute("rotation",d),p.setAttribute("position",m),a.appendChild(p)}}a&&e.appendChild(a)}));var n=document.createElement("a-entity");return n.setAttribute("camera",""),e.appendChild(n),e},n.handleIframeComplete=function(){var t=this;"complete"!==this.iframeDocument.readyState?this.iframeDocument.addEventListener("readystatechange",(function(){"complete"===t.iframeDocument.readyState&&t.addEventListeners()})):this.addEventListeners(),this.waitForVideo((function(e){t.video=e,t.params.fallbackHeight=parseInt(t.video.style.height),t.resize()}))},n.waitForVideo=function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;if(t&&!(n<=0)){var i=this.iframeDocument.querySelector("#arjs-video");i&&parseInt(i.style.height)>0?t(i):setTimeout((function(){e.waitForVideo(t,n-100)}),100)}},n.addEventListeners=function(){var t=this;Array.from(this.iframeDocument.querySelectorAll("a-marker")).forEach((function(e){e.addEventListener("markerFound",(function(e){t.callbacks.onMarkerFound(e)})),e.addEventListener("markerLost",(function(e){t.callbacks.onMarkerLost(e)}))}))},n.handleIframeLoaded=function(t){var e=this;try{var n=t.contentWindow;n.addEventListener("resize",this.resize),t.contentWindow.document.open(),t.contentWindow.document.write(this.buildHTML().outerHTML),t.contentWindow.document.close(),this.iframeDocument=t.contentDocument?t.contentDocument:n,this.handleIframeComplete(),setTimeout((function(){e.resize()}),0)}catch(t){}},t}(),a=function(){function t(t,n){var i=this;this.params=e.extend({a11y:{active:"",disabled:"",inactive:""},active:!1,classes:[],disabled:!1,type:"pulse"},t||{}),Array.isArray(this.params.classes)||(this.params.classes=[this.params.classes]),"pulse"===this.params.type&&(this.params.a11y.inactive||(this.params.a11y.inactive=this.params.a11y.active||""),this.params.a11y.active||(this.params.a11y.active=this.params.a11y.inactive||"")),this.active=this.params.active,this.disabled=this.params.disabled,this.callbacks=n||{},this.callbacks.onClick=this.callbacks.onClick||function(){},this.button=document.createElement("button"),this.params.classes&&this.params.classes.forEach((function(t){i.button.classList.add(t)})),this.button.setAttribute("aria-pressed",this.params.active),this.button.setAttribute("tabindex","0"),!0===this.params.active?this.activate():this.deactivate(),!0===this.params.disabled?this.disable():this.enable(),this.button.addEventListener("click",(function(t){i.disabled||("toggle"===i.params.type&&i.toggle(),i.callbacks.onClick(t))}))}var n=t.prototype;return n.getDOM=function(){return this.button},n.show=function(){this.button.classList.remove("h5p-ar-scavenger-button-display-none")},n.hide=function(){this.button.classList.add("h5p-ar-scavenger-button-display-none")},n.focus=function(){this.button.focus()},n.enable=function(){this.disabled=!1,this.button.classList.remove("h5p-ar-scavenger-button-disabled"),this.active?this.activate():this.deactivate()},n.disable=function(){this.button.classList.add("h5p-ar-scavenger-button-disabled"),this.button.setAttribute("aria-label",this.params.a11y.disabled),this.button.setAttribute("title",this.params.a11y.disabled),this.disabled=!0},n.activate=function(){this.disabled||("toggle"===this.params.type&&(this.button.classList.add("h5p-ar-scavenger-button-active"),this.button.setAttribute("aria-pressed",!0)),this.button.setAttribute("aria-label",this.params.a11y.active),this.button.setAttribute("title",this.params.a11y.active),this.active=!0)},n.deactivate=function(){this.disabled||(this.active=!1,"toggle"===this.params.type&&(this.button.classList.remove("h5p-ar-scavenger-button-active"),this.button.setAttribute("aria-pressed",!1)),this.button.setAttribute("aria-label",this.params.a11y.inactive),this.button.setAttribute("title",this.params.a11y.inactive))},n.toggle=function(){this.disabled||(this.active?this.deactivate():this.activate())},n.isActive=function(){return this.active},n.isDisabled=function(){return this.disabled},t}(),s=function(){function t(t,n){this.params=e.extend({title:"",a11y:{}},t||{}),this.callbacks=n||{},this.callbacks.onClickButtonFullScreen=this.callbacks.onClickButtonFullScreen||function(){},this.callbacks.onClickButtonQuit=this.callbacks.onClickButtonQuit||function(){},this.callbacks.onClickButtonSwitchView=this.callbacks.onClickButtonSwitchView||function(){},this.titleBar=document.createElement("div"),this.titleBar.classList.add("h5p-ar-scavenger-title-bar"),this.buttons={},this.buttons.switchView=new a({a11y:{inactive:this.params.a11y.buttonSwitchViewAction,active:this.params.a11y.buttonSwitchViewCamera,disabled:this.params.a11y.buttonSwitchViewDisabled},classes:["h5p-ar-scavenger-button","h5p-ar-scavenger-button-switch-view"],type:"toggle",active:!0},{onClick:this.callbacks.onClickButtonSwitchView}),this.titleBar.appendChild(this.buttons.switchView.getDOM());var i=document.createElement("div");i.classList.add("h5p-ar-scavenger-title"),i.innerHTML=this.params.title,this.titleBar.appendChild(i),this.buttons.quit=new a({a11y:{active:this.params.a11y.buttonQuit,disabled:this.params.a11y.buttonQuitDisabled},classes:["h5p-ar-scavenger-button","h5p-ar-scavenger-button-quit"],disabled:!0,type:"pulse"},{onClick:this.callbacks.onClickButtonQuit}),this.buttons.quit.hide(),this.titleBar.appendChild(this.buttons.quit.getDOM()),this.params.canHasFullScreen&&(this.buttons.fullscreen=new a({a11y:{active:this.params.a11y.buttonFullScreenExit,inactive:this.params.a11y.buttonFullScreenEnter},classes:["h5p-ar-scavenger-button","h5p-ar-scavenger-button-fullscreen"],disabled:!1,type:"toggle"},{onClick:n.onClickButtonFullScreen}),this.titleBar.appendChild(this.buttons.fullscreen.getDOM()))}var n=t.prototype;return n.getDOM=function(){return this.titleBar},n.showButton=function(t){this.buttons[t]&&this.buttons[t].show()},n.hideButton=function(t){this.buttons[t]&&this.buttons[t].hide()},n.focusButton=function(t){this.buttons[t]&&this.buttons[t].focus()},n.toggleButtonActive=function(t,e){this.buttons[t]&&("boolean"!=typeof e&&(e=!this.buttons[t].isActive()),!0===e?this.buttons[t].activate():this.buttons[t].deactivate())},n.toggleButtonDisabled=function(t,e){this.buttons[t]&&("boolean"!=typeof e&&(e=!this.buttons[t].isDisabled()),!0===e?this.buttons[t].disable():this.buttons[t].enable())},n.isButtonActive=function(t){return this.buttons[t]?this.buttons[t].isActive():null},n.isButtonDisabled=function(t){return this.buttons[t]?this.buttons[t].isDisabled():null},t}(),r=function(){function t(t,e,n){if(this.params=t,this.callbacks=e||{},this.callbacks.onClose=e.onClose||function(){},this.baseClassName="h5p-ar-scavenger-screen",this.screen=document.createElement("div"),this.screen.classList.add("".concat(this.baseClassName)),this.params.id&&this.screen.classList.add("".concat(this.baseClassName,"-").concat(this.params.id)),this.params.screenImage&&this.params.screenImage.params&&this.params.screenImage.params.file){var i=document.createElement("div");i.classList.add("".concat(this.baseClassName,"-image-wrapper")),this.params.screenText&&i.classList.add("small-margin-bottom"),H5P.newRunnable(t.screenImage,n,H5P.jQuery(i),!1);var a=i.querySelector("img");a.classList.add("".concat(this.baseClassName,"-image")),a.style.height="auto",a.style.width="auto";var s=document.createElement("div");s.classList.add("".concat(this.baseClassName,"-image-bar")),i.appendChild(s),this.screen.appendChild(i)}if(this.params.screenText){var r=document.createElement("div");r.classList.add("".concat(this.baseClassName,"-text")),r.innerHTML=this.params.screenText,this.screen.appendChild(r)}this.button=H5P.JoubelUI.createButton({class:"".concat(this.baseClassName,"-button-close"),text:this.params.l10n.buttonText,click:this.callbacks.onClose}).get(0),this.hide(),this.screen.appendChild(this.button)}var e=t.prototype;return e.getDOM=function(){return this.screen},e.show=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.screen.classList.remove("h5p-ar-scavenger-display-none"),t.focusStartButton&&this.button.focus()},e.hide=function(){this.screen.classList.add("h5p-ar-scavenger-display-none")},t}(),o=function(){function t(t,n){this.params=e.extend({},t||{}),this.callbacks=n||{},this.feedbackSection=document.createElement("div"),this.feedbackSection.classList.add("h5p-ar-scavenger-feedback-section"),this.scoreText=document.createElement("div"),this.scoreText.classList.add("h5p-ar-scavenger-score-text"),this.scoreText.innerText="",this.feedbackSection.appendChild(this.scoreText),this.scoreBar=H5P.JoubelUI.createScoreBar(0),this.scoreBar.setScore(-1),this.scoreBar.appendTo(H5P.jQuery(this.feedbackSection))}var n=t.prototype;return n.getDOM=function(){return this.feedbackSection},n.show=function(){this.feedbackSection.classList.remove("h5p-ar-scavenger-display-none")},n.hide=function(){this.feedbackSection.classList.add("h5p-ar-scavenger-display-none")},n.setScore=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.scoreBar.setScore(t)},n.setMaxScore=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.scoreBar.setMaxScore(t)},n.setScoreText=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.scoreText.innerText=e.htmlDecode(t)},t}();function c(t,e){return c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},c(t,e)}var h=function(t){var e,n;function i(e,n,i){var a;return(a=t.call(this,e,n,i)||this).feedbackSection=new o({},{}),a.button.parentNode.insertBefore(a.feedbackSection.getDOM(),a.button),a}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,c(e,n);var a=i.prototype;return a.setScoreText=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.feedbackSection.setScoreText(t)},a.setScore=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.feedbackSection.setScore(t)},a.setMaxScore=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.feedbackSection.setMaxScore(t)},i}(r);function l(t,e){return l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},l(t,e)}var u=function(t){var e,n;function i(e,n,i){return t.call(this,e,n,i)||this}return n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,l(e,n),i}(r),d=function(){function t(){}var a=t.prototype;return a.buildTitleBar=function(){var t=this;return new s({title:this.extras.metadata.title,a11y:{buttonFullScreenEnter:this.params.a11y.buttonFullScreenEnter,buttonFullScreenExit:this.params.a11y.buttonFullScreenExit,buttonSwitchViewAction:this.params.a11y.buttonSwitchViewAction,buttonSwitchViewCamera:this.params.a11y.buttonSwitchViewCamera,buttonSwitchViewDisabled:this.params.a11y.buttonSwitchViewDisabled,buttonQuit:this.params.a11y.buttonQuit,buttonQuitDisabled:this.params.a11y.buttonQuitDisabled},canHasFullScreen:this.params.canHasFullScreen},{onClickButtonFullScreen:function(e){return t.callbacks.onFullScreen(e)},onClickButtonQuit:function(e){return t.handleQuit(e)},onClickButtonSwitchView:function(){return t.handleSwitchView()}})},a.buildTitleScreen=function(){var t=this;return new u({id:"title",screenImage:this.params.titleScreen.titleScreenImage,screenText:this.params.titleScreen.titleScreenIntroduction,l10n:{buttonText:this.params.l10n.start}},{onClose:function(){t.handleTitleScreenClosed()}},this.contentId)},a.buildEndScreen=function(){var t=this;return new h({id:"end",screenImage:this.params.endScreen.endScreenImage,screenText:this.params.endScreen.endScreenOutro,l10n:{buttonText:this.params.l10n.retry}},{onClose:function(){t.handleRetry()}},this.contentId)},a.buildCamera=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=new i({contentId:e.contentId,fallbackHeight:e.fallbackHeight,markers:e.markers.map((function(t){return{actionType:t.actionType,markerPattern:t.markerPattern,model:t.model}}))},n),r=s.getDOM();return a||r.classList.add("h5p-ar-scavenger-action-mode"),r.addEventListener("transitionend",(function(){a||0===r.offsetWidth&&r.classList.add("h5p-ar-scavenger-display-none"),setTimeout((function(){t.instances[t.currentInstanceId]&&t.instances[t.currentInstanceId].trigger("resize"),t.resize()}),100)})),s},a.buildAction=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=new n(e,i);return a.hide(),a.getDOM().addEventListener("transitionend",(function(){t.isCameraMode&&a.hide(),setTimeout((function(){t.instances[t.currentInstanceId]&&t.instances[t.currentInstanceId].trigger("resize"),t.resize()}),0)})),a},a.handleInitializationFailed=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.messages.innerHTML="",this.messages.classList.add("h5p-ar-scavenger-content-message-error"),n.forEach((function(n){var i=document.createElement("p");i.innerText=e.htmlDecode(n),t.messages.appendChild(i)}))},a.handleInitializationSucceeded=function(){var t=this;this.params.showTitleScreen&&(this.hide(),this.screenTitle.show()),this.screenContent.removeChild(this.messages),this.titlebar=this.buildTitleBar(),this.screenContent.appendChild(this.titlebar.getDOM()),this.camera=this.buildCamera({contentId:this.contentId,markers:this.params.markers,fallbackHeight:this.params.behaviour.fallbackHeight},{onResize:function(){t.resize({fromSubject:!0})},onMarkerFound:function(e){t.handleMarkerFound(e)},onMarkerLost:function(e){t.handleMarkerLost(e)}},this.isCameraMode),this.action=this.buildAction({l10n:{nothingToSee:this.params.l10n.nothingToSee}},{});var e=document.createElement("div");e.classList.add("h5p-ar-scavenger-panel"),e.appendChild(this.camera.getDOM()),e.appendChild(this.action.getDOM()),this.screenContent.appendChild(e),this.params.showEndScreen&&(this.screenEnd=this.buildEndScreen(),this.container.appendChild(this.screenEnd.getDOM())),this.instantiateMarkers(),this.instances.forEach((function(e,n){e&&t.instantiateContent(n)})),this.params.showEndScreen&&this.getMaxScore()>0?this.titlebar.showButton("quit"):this.titlebar.hideButton("quit"),0===this.instancesH5P&&this.titlebar.hideButton("switchView")},a.instantiateMarkers=function(){var t=this;this.params.markers.forEach((function(e,n){if(t.markersFound[n]=t.markersFound[n]||{actionType:e.actionType,completed:!1},"h5p"!==e.actionType)return t.instances.push(null),void t.instanceDOMs.push(null);var i,a=e.interaction.interaction;if(a.library&&(i=a.library.split(" ")[0]),void 0!==i&&t.contentId){var s=document.createElement("div");s.classList.add("h5p-ar-scavenger-content-action-library-wrapper");var r=null!==t.extras.previousState[n]?t.extras.previousState[n]:void 0,o={uninstantiated:{interaction:a,contentId:t.contentId,actionWrapper:s,previousState:r,index:n,machineName:i},on:function(){},trigger:function(){}};t.instancesH5P++,t.instances.push(o),t.instanceDOMs.push(s)}else t.instances.push(null),t.instanceDOMs.push(null)}))},t}(),m=function(){function t(){}var e=t.prototype;return e.handleMarkerFound=function(t){var e=this;if(this.isShown&&(this.isCameraMode||!this.isNarrowScreen)){var n=parseInt(t.target.id);"h5p"===this.params.markers[n].actionType&&(this.instantiateContent(n),this.instances[n].setActivityStarted(),this.currentInstanceId=n,this.action.attachInstance(this.instanceDOMs[n],n),this.action.showContent(),this.action.show(),this.isCameraMode&&(this.titlebar.toggleButtonActive("switchView",!1),this.toggleView()),setTimeout((function(){e.instances[n].trigger("resize")}),0))}},e.handleMarkerGotCompleted=function(t){this.markersFound[t].completed=!0,this.markersFound.reduce((function(t,e){return t+(e&&e.completed?1:0)}),0)===this.tasksH5P&&this.handleCompleted()},e.handleMarkerLost=function(t){return t},e.handleTitleScreenClosed=function(){var t=this;this.screenTitle&&this.screenTitle.hide(),this.show(),this.titlebar&&this.titlebar.focusButton("switchView"),setTimeout((function(){t.callbacks.onResize()}),0)},e.handleCompleted=function(){this.params.showEndScreen&&(this.titlebar.showButton("quit"),this.titlebar.toggleButtonDisabled("quit",!1))},e.handleQuit=function(){var t=this;if(this.params.showEndScreen){var e=this.getScore(),n=this.getMaxScore(),i=H5P.Question.determineOverallFeedback(this.params.endScreen.overallFeedback,e/n).replace("@score",e).replace("@total",n);this.screenEnd.setScoreText(i),this.screenEnd.setMaxScore(this.getMaxScore()),this.hide(),this.screenEnd.show(),setTimeout((function(){t.screenEnd.setScore(t.getScore()),t.callbacks.onResize()}),0)}this.callbacks.onQuit()},e.handleRetry=function(){var t=this;this.reset(),this.screenEnd.hide(),this.params.showTitleScreen?this.screenTitle.show({focusStartButton:!0}):this.show(),this.params.showEndScreen&&this.getMaxScore()>0?(this.titlebar.toggleButtonDisabled("quit",!0),this.titlebar.showButton("quit")):this.titlebar.hideButton("quit"),setTimeout((function(){t.callbacks.onResize()}),0)},e.handleSwitchView=function(){var t=!this.titlebar.isButtonActive("switchView")?this.params.a11y.actionOpened:this.params.a11y.actionClosed;this.callbacks.onRead(t),this.toggleView()},t}(),p=function(){function t(n,i,a,s){var r=this;e.addMixins(t,[d,m]),this.params=n,this.contentId=i,this.extras=a||{},this.extras.previousState=this.extras.previousState||[],this.callbacks=s||{},this.callbacks.onFullScreen=this.callbacks.onFullScreen||function(){},this.callbacks.onQuit=this.callbacks.onQuit||function(){return null},this.callbacks.onRead=this.callbacks.onRead||function(){},this.callbacks.onResize=this.callbacks.onResize||function(){},this.isCameraMode=!0,this.instancesInitialized=0,this.instances=[],this.instanceDOMs=[],this.instancesH5P=0,this.tasksH5P=0,this.markersFound=new Array(this.params.markers.length),this.container=document.createElement("div"),this.container.classList.add("h5p-ar-scavenger-screen-content"),this.params.showTitleScreen&&(this.screenTitle=this.buildTitleScreen(),this.container.appendChild(this.screenTitle.getDOM())),this.screenContent=document.createElement("div"),this.screenContent.classList.add("h5p-ar-scavenger-content-container"),this.container.appendChild(this.screenContent),this.messages=document.createElement("div"),this.messages.classList.add("h5p-ar-scavenger-content-message"),this.messages.innerText=e.htmlDecode(this.params.l10n.initializingContent),this.screenContent.appendChild(this.messages);var o=[];0===n.markers.length&&o.push(this.params.l10n.errorNoMarkers),-1!==window.navigator.userAgent.indexOf("Trident/")&&o.push(this.params.l10n.errorBrowserNotSupported),window.Brave&&o.push(this.params.l10n.warningBrave),window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia||o.push(this.params.l10n.errorNoCameraSupport),0===o.length?(window.navigator.mediaDevices.getUserMedia({video:{width:4096,height:2160}}).then((function(t){t.getTracks().forEach((function(t){t.stop()})),r.handleInitializationSucceeded()})).catch((function(t){var e="".concat(r.params.l10n.errorNoCameraAccess," ").concat(t.message);r.handleInitializationFailed([e])})),this.handleTitleScreenClosed()):this.handleInitializationFailed(o)}var n=t.prototype;return n.instantiateContent=function(t){var n=this;if(this.instances[t].uninstantiated){var i=this.instances[t].uninstantiated,a=i.index,s=i.machineName;"always"===this.params.behaviour.overrideShowSolutionButton?i.interaction.params.behaviour.enableSolutionsButton=!0:"never"===this.params.behaviour.overrideShowSolutionButton&&(i.interaction.params.behaviour.enableSolutionsButton=!1),"always"===this.params.behaviour.overrideRetryButton?i.interaction.params.behaviour.enableRetry=!0:"never"===this.params.behaviour.overrideRetryButton&&(i.interaction.params.behaviour.enableRetry=!1),this.instances[t]=H5P.newRunnable(i.interaction,i.contentId,H5P.jQuery(i.actionWrapper),!0,{previousState:i.previousState}),this.instances[t].on("resize",(function(){n.resize({fromAction:!0})})),e.isTask(this.instances[t],s)&&(this.tasksH5P++,this.instances[t].on("xAPI",(function(t){"answered"!==t.getVerb()&&"completed"!==t.getVerb()||setTimeout((function(){n.handleMarkerGotCompleted(a)}),0)})))}},n.getDOM=function(){return this.container},n.show=function(){this.screenContent.classList.remove("h5p-ar-scavenger-display-none"),this.isShown=!0},n.hide=function(){this.screenContent.classList.add("h5p-ar-scavenger-display-none"),this.isShown=!1},n.resize=function(t){var e=this;this.camera?(this.container.offsetWidth<this.params.minWidthForDualView?this.isNarrowScreen||(this.isNarrowScreen=!0,this.camera.setNarrowView(!0)):(this.camera.show(),setTimeout((function(){e.camera.setNarrowView(!1)}),0),this.isNarrowScreen&&(this.isNarrowScreen=!1)),t&&!0===t.fromSubject||this.camera.resize(),this.callbacks.onResize()):this.callbacks.onResize()},n.setFullScreen=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0===e?setTimeout((function(){var e=window.innerHeight-t.titlebar.getDOM().offsetHeight;t.camera.resizeIframeHeight(e),t.action.resizeIframeHeight(e)}),100):(setTimeout((function(){t.camera.resizeIframeHeight(null),t.action.resizeIframeHeight(null)}),100),this.titlebar.toggleButtonActive("fullscreen",!1))},n.toggleView=function(){var t=this;this.camera.show(),this.action.show(),setTimeout((function(){t.camera.toggleView(),t.action.toggleView(),t.isCameraMode=!t.isCameraMode,t.resize()}),0)},n.getAnswerGiven=function(){return this.instances.some((function(t){return t&&"function"==typeof t.getAnswerGiven&&t.getAnswerGiven()}))},n.getScore=function(){return this.instances.reduce((function(t,e){return t+(e&&"function"==typeof e.getScore?e.getScore():0)}),0)},n.getMaxScore=function(){return this.instances.reduce((function(t,e){return t+(e&&"function"==typeof e.getMaxScore?e.getMaxScore():0)}),0)},n.showSolutions=function(){this.instances.forEach((function(t){t&&"function"==typeof t.showSolutions&&t.showSolutions()}))},n.reset=function(){for(var t=0;t<this.markersFound.length;t++)this.markersFound[t]&&(this.markersFound[t].completed=!1);this.titlebar.toggleButtonActive("switchView",!1),this.titlebar.toggleButtonActive("quit",!1),this.titlebar.toggleButtonDisabled("quit",!0),this.isCameraMode||this.toggleView(),this.instances.forEach((function(t){t&&"function"==typeof t.resetTask&&t.resetTask()})),this.action.hideContent()},n.getXAPIDataFromChildren=function(){return this.instances.map((function(t){if(t&&"function"==typeof t.getXAPIData)return t.getXAPIData()})).filter((function(t){return!!t}))},n.getCurrentState=function(){return this.instances.map((function(t){return t&&"function"==typeof t.getCurrentState?t.getCurrentState():{}}))},t}();function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t,e){return g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},g(t,e)}var b=function(t){var n,i;function a(n,i){var s,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(s=t.call(this,"ar-scavenger")||this).contentId=i,s.params=e.extend({showTitleScreen:!1,canHasFullScreen:H5P.canHasFullScreen,markers:[],showEndScreen:!1,behaviour:{enableSolutionsButton:!1,enableRetry:!1,overrideShowSolutionButton:"useBehavioural",overrideRetryButton:"useBehavioural",fallbackHeight:400},l10n:{start:"Start",retry:"Retry",nothingToSee:"Find a marker to see an interaction.",errorBrowserNotSupported:"It seems that your browser cannot run this content type, unfortunately.",errorNoCameraAccess:"Could not access camera.",errorNoCameraSupport:"Your browser does not seem to support a camera.",errorNoMarkers:"Did someone forget to add markers?",warningBrave:"You seem to be using the Brave browser. Nice! But its strict privacy settings may prevent the camera from working.",initializingContent:"Initializing content. Please don't forget to allow camera access."},a11y:{buttonFullScreenEnter:"Enter fullscreen mode",buttonFullScreenExit:"Exit fullscreen mode",buttonSwitchViewAction:"Switch to an exercise",buttonSwitchViewCamera:"Switch to the camera",buttonSwitchViewDisabled:"You cannot switch the view right now",buttonQuit:"Quit exercise",buttonQuitDisabled:"You have not yet completed all exercises",actionOpened:"The view has switched to an exercise.",actionClosed:"The view has switched to the camera."},minWidthForDualView:a.MIN_WIDTH_FOR_DUALVIEW},n),s.params.markers=s.params.markers.filter((function(t){return t.markerImage&&t.markerPattern&&("h5p"===t.actionType&&t.interaction&&t.interaction.interaction||"model"===t.actionType&&t.model&&t.model.file)})),s.extras=e.extend({metadata:{title:"ARScavenger"}},r);var o=r.metadata.defaultLanguage||"en";return s.languageTag=e.formatLanguageCode(o),s.params.canHasFullScreen&&(s.on("enterFullScreen",(function(){setTimeout((function(){s.content.setFullScreen(!0),s.isInFullScreen=!0}),250)})),s.on("exitFullScreen",(function(){s.isInFullScreen=!1,s.content.setFullScreen(!1)}))),s.registerDomElements=function(){s.params.behaviour.showActionOnStartup=s.params.behaviour.showActionOnStartup&&document.querySelector(".h5p-container").offsetWidth>=a.MIN_WIDTH_FOR_DUALVIEW,s.content=new p(s.params,s.contentId,s.extras,{onFullScreen:s.toggleFullScreen,onQuit:s.handleCompleted,onRead:s.read,onResize:s.resize}),s.setContent(s.content.getDOM()),screen&&screen.orientation?screen.orientation.addEventListener("change",(function(){s.handleScreenOrientationChanged()})):window.addEventListener("change",(function(){s.handleScreenOrientationChanged()}))},s.toggleFullScreen=function(){!0===H5P.canHasFullScreen&&(!0===H5P.isFullscreen?H5P.exitFullScreen():H5P.fullScreen(H5P.jQuery(document.querySelector(".h5p-container")),f(s)))},s.handleCompleted=function(){setTimeout((function(){var t=s.getXAPIData();t.statement.object.definition.interactionType="other";var e=new H5P.XAPIEvent;e.data.children=t.children,e.data.statement=t.statement,s.trigger(e)}),0)},s.handleScreenOrientationChanged=function(){s.isInFullScreen?s.content.setFullScreen(!0):s.resize()},s.getAnswerGiven=function(){return s.content.getAnswerGiven()},s.getScore=function(){return s.content.getScore()},s.getMaxScore=function(){return s.content.getMaxScore()},s.showSolutions=function(){s.content.showSolutions()},s.resetTask=function(){s.content.reset()},s.on("resize",(function(t){t.data&&!0===t.data.break||s.content.resize()})),s.resize=function(){s.trigger("resize",{break:!0})},s.getXAPIData=function(){return{children:s.content.getXAPIDataFromChildren(),statement:s.getXAPIAnswerEvent().data.statement}},s.getXAPIAnswerEvent=function(){var t=s.createXAPIEvent("answered");return t.setScoredResult(s.getScore(),s.getMaxScore(),f(s),s.getAnswerGiven(),s.isPassed()),t},s.createXAPIEvent=function(t){var n=s.createXAPIEventTemplate(t);return e.extend(n.getVerifiedStatementValue(["object","definition"]),s.getxAPIDefinition()),n},s.getxAPIDefinition=function(){var t={name:{}};return t.name[s.languageTag]=s.getTitle(),t.name["en-US"]=t.name[s.languageTag],t.description={},t.description[s.languageTag]=s.getDescription(),t.description["en-US"]=t.description[s.languageTag],t.type="http://adlnet.gov/expapi/activities/cmi.interaction",t.interactionType="compound",t},s.isPassed=function(){return s.content.getScore()===s.content.getMaxScore()},s.getTitle=function(){var t;return s.extras.metadata&&(t=s.extras.metadata.title),t=t||a.DEFAULT_DESCRIPTION,H5P.createTitle(t)},s.getDescription=function(){return s.params.taskDescription||a.DEFAULT_DESCRIPTION},s.getCurrentState=function(){return s.content.getCurrentState()},s}return i=t,(n=a).prototype=Object.create(i.prototype),n.prototype.constructor=n,g(n,i),a}(H5P.Question);b.DEFAULT_DESCRIPTION="ARScavenger",b.MIN_WIDTH_FOR_DUALVIEW=1024,H5P=H5P||{},H5P.ARScavenger=b})();